"use strict";var myAPP=angular.module("app",["ui.router","ngCookies","validation"]);myAPP.config(["$stateProvider","$urlRouterProvider","$validationProvider",function(t,e,o){t.state("main",{url:"/main",templateUrl:"./view/main.html",controller:"MainController"}).state("position",{url:"/position/:id",templateUrl:"./view/position.html",controller:"PositionController"}).state("company",{url:"/company/:id",templateUrl:"view/company.html",controller:"CompanyController"}).state("login",{url:"/login",templateUrl:"./view/login.html",controller:"LoginController"}).state("register",{url:"/register",templateUrl:"view/register.html",controller:"RegisterController"}).state("search",{url:"/search",templateUrl:"view/search.html",controller:"SearchController"}).state("me",{url:"/me",templateUrl:"view/me.html",controller:"MeController"}).state("post",{url:"/post",templateUrl:"view/post.html",controller:"PostController"}).state("favorite",{url:"/favorite",templateUrl:"view/favorite.html",controller:"FavoriteController"}),e.otherwise("main");var n={phone:/^1[\d]{10}$/,password:function(t){return(t+"").length>5},required:function(t){return!!t}},i={phone:{success:"",error:"必须是11位手机号"},password:{success:"",error:"长度至少是六位"},required:{success:"",error:"不能为空"}};o.setExpression(n).setDefaultMsg(i)}]),myAPP.controller("MainController",["$scope","$http",function(t,e){t.list="",e.get("./data/positionList.json").success(function(e){t.list=e})}]),myAPP.controller("PositionController",["$scope","$http","$state","$q","cache","$log",function(t,e,o,n,i,s){function a(o){e.get("./data/company.json?id="+o).success(function(e){t.companyData=e})}t.isLogin=!!i.get("name"),t.message=t.isLogin?"投个简历":"去登录",t.positionData="",t.companyData="",function(){var i=n.defer();return e.get("./data/position.json?id="+o.params.id).success(function(e){t.positionData=e,e.posted&&(t.message="已投递"),i.resolve(e)}).error(function(t){i.reject(t)}),i.promise}().then(function(t){console.log("你所查看的公司id",t.companyId),a(t.companyId)}),t.go=function(){"已投递"!==t.message&&(t.isLogin?e.post("data/handle.json",{id:t.positionData.id}).success(function(e){s.info(e),t.message="已投递"}):o.go("login"))}}]),myAPP.controller("CompanyController",["$scope","$http","$state",function(t,e,o){t.companyData="",e.get("./data/company.json?id="+o.params.id).success(function(e){t.companyData=e})}]),myAPP.controller("SearchController",["dict","$scope","$http",function(t,e,o){e.list="",e.name="",e.search=function(){o.get("./data/positionList.json?name="+e.name).success(function(t){e.list=t})},e.search(),e.sheet={},e.tabList=[{id:"city",name:"城市"},{id:"salary",name:"薪水"},{id:"scale",name:"公司规模"}],e.filterObj={};var n="";e.tClick=function(o,i){console.log("点击tab传过来的id",o),console.log("点击tab传过来的name",i),n=o,e.sheet.list=t[o],e.sheet.visible=!0},e.sClick=function(t,o){console.log("点击选项卡传过来的id",t),console.log("点击选项卡传过来的name",o),t?(angular.forEach(e.tabList,function(t){t.id===n&&(t.name=o)}),e.filterObj[n+"Id"]=t,console.log("筛选器对象",e.filterObj)):(delete e.filterObj[n+"Id"],angular.forEach(e.tabList,function(t){if(t.id===n)switch(t.id){case"city":t.name="城市";break;case"salary":t.name="薪水";break;case"scale":t.name="公司规模"}}))}}]),myAPP.controller("LoginController",["$scope","cache","$state","$http",function(t,e,o,n){t.submit=function(){n.post("data/login.json",t.user).success(function(n){console.log("登录的信息",t.user),console.log("登陆后返回的信息",n),e.put("id",n.id),e.put("name",n.name),e.put("image",n.image),console.log("cookies里存储的信息",e),o.go("main")})}}]),myAPP.controller("RegisterController",["$scope","$interval","$http","$state",function(t,e,o,n){t.submit=function(){o.post("data/regist.json",t.user).success(function(e){console.log("注册表单传入的信息",t.user),console.log("注册返回的信息",e),n.go("login")})};var i=0;t.send=function(){o.get("data/code.json").success(function(o){if(1===o.state){i=60,t.time="60s";var n=e(function(){i<=0?(e.cancel(n),t.time=""):(i--,t.time=i+"s")},1e3)}})}}]),myAPP.controller("MeController",["$scope","cache","$http","$state",function(t,e,o,n){e.get("name")&&(t.name=e.get("name"),t.image=e.get("image")),t.logout=function(){e.remove("id"),e.remove("name"),e.remove("image"),n.go("main")}}]),myAPP.controller("PostController",["$scope","$http",function(t,e){t.tabList=[{id:"all",name:"全部"},{id:"pass",name:"面试邀请"},{id:"fail",name:"不合适"}],e.get("data/myPost.json").success(function(e){t.positionList=e}),t.filterObj={},t.tClick=function(e,o){switch(e){case"all":delete t.filterObj.state;break;case"pass":t.filterObj.state="1";break;case"fail":t.filterObj.state="-1"}}}]),myAPP.controller("FavoriteController",["$scope","$http",function(t,e){e.get("data/myFavorite.json").success(function(e){t.list=e})}]),angular.module("app").service("cache",["$cookies",function(t){this.put=function(e,o){t.put(e,o)},this.get=function(e){return t.get(e)},this.remove=function(e){t.remove(e)}}]),myAPP.value("dict",{}).run(["dict","$http",function(t,e){e.get("data/city.json").success(function(e){t.city=e}),e.get("data/salary.json").success(function(e){t.salary=e}),e.get("data/scale.json").success(function(e){t.scale=e})}]),myAPP.filter("filterByObj",[function(){return function(t,e){var o=[];return angular.forEach(t,function(t){var n=!0;for(var i in e)t[i]!==e[i]&&(n=!1);n&&o.push(t)}),o}}]),myAPP.config(["$provide",function(t){t.decorator("$http",["$delegate","$q",function(t,e){return t.post=function(o,n,i){var s=e.defer();return t.get(o).success(function(t){s.resolve(t)}).error(function(t){s.reject(t)}),{success:function(t){s.promise.then(t)},error:function(t){s.promise.then(null,t)}}},t}])}]),myAPP.directive("appCompanyClass",[function(){return{restrict:"A",replace:!0,templateUrl:"./view/template/companyClass.html",scope:{com:"="},link:function(t){t.isActive="",t.showPositionList=function(e){t.isActive=e,t.positionListData=t.com.positionClass[e].positionList},t.$watch("com",function(e,o){e&&t.showPositionList(0)})}}}]),myAPP.directive("appMainFoot",[function(){return{restrict:"A",replace:!0,templateUrl:"./view/template/mainFoot.html"}}]),myAPP.directive("appMainHead",["cache",function(t){return{restrict:"A",replace:!0,templateUrl:"./view/template/mainHead.html",link:function(e){e.name=t.get("name")||""}}}]),myAPP.directive("appMainList",["$http",function(t){return{restrict:"A",replace:!0,templateUrl:"./view/template/mainList.html",scope:{data:"=",filterObj:"=",isFavorite:"=",tClick:"&"},link:function(e){e.select=function(e){t.post("data/favorite.json",{id:e.id,select:!e.select}).success(function(t){e.select=!e.select})}}}}]),myAPP.directive("appPositionCompany",[function(){return{restrict:"A",replace:!0,templateUrl:"./view/template/positionCompany.html",scope:{com:"="}}}]),myAPP.directive("appPositionHead",[function(){return{restrict:"A",replace:!0,templateUrl:"./view/template/positionHead.html",scope:{text:"@"},link:function(t){t.back=function(){window.history.back()}}}}]),myAPP.directive("appPositionInfo",["$http",function(t){return{restrict:"A",replace:!0,templateUrl:"./view/template/positionInfo.html",scope:{isActive:"=",isLogin:"=",pos:"="},link:function(e){e.$watch("pos",function(t){t&&(e.pos.select=e.pos.select||!1,e.imagePath=e.pos.select?"image/star-active.png":"image/star.png")}),e.favorite=function(){t.post("data/favorite.json",{id:e.pos.id,select:!e.pos.select}).success(function(t){e.pos.select=!e.pos.select,e.imagePath=e.pos.select?"image/star-active.png":"image/star.png"})}}}}]),myAPP.directive("appSearchSheet",[function(){return{restrict:"A",replace:!0,templateUrl:"./view/template/searchSheet.html",scope:{list:"=",visible:"=",select:"&"}}}]),myAPP.directive("appSearchTab",[function(){return{restrict:"A",replace:!0,templateUrl:"./view/template/searchTab.html",scope:{list:"=",tabClick:"&"},link:function(t){t.click=function(e){console.log("tabItem的数据",e),t.selectId=e.id,t.tabClick(e)}}}}]);